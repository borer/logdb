package org.logdb.bbtree;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.logdb.bit.BinaryHelper;
import org.logdb.bit.ByteArrayComparator;
import org.logdb.root.index.RootIndex;
import org.logdb.storage.Storage;
import org.logdb.storage.StorageUnits;
import org.logdb.storage.memory.MemoryStorage;
import org.logdb.support.KeyValueUtils;
import org.logdb.support.StubTimeSource;
import org.logdb.support.TestUtils;

import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.fail;
import static org.logdb.support.KeyValueUtils.generateKeyValuePair;
import static org.logdb.support.TestUtils.INITIAL_VERSION;
import static org.logdb.support.TestUtils.MEMORY_CHUNK_SIZE;
import static org.logdb.support.TestUtils.createInitialRootReference;
import static org.logdb.support.TestUtils.createRootIndex;

class BTreeImplTest
{
    private static final int PAGE_SIZE = 256;
    private static final int MAX_LOG_SIZE = 0;

    private BTreeImpl bTree;

    @BeforeEach
    void setUp()
    {
        final Storage storage = new MemoryStorage(TestUtils.BYTE_ORDER, PAGE_SIZE, MEMORY_CHUNK_SIZE);
        final RootIndex rootIndex = createRootIndex(PAGE_SIZE);

        final NodesManager nodesManager = new NodesManager(storage, rootIndex, true, MAX_LOG_SIZE);

        bTree = new BTreeImpl(
                nodesManager,
                new StubTimeSource(),
                INITIAL_VERSION,
                StorageUnits.INVALID_PAGE_NUMBER,
                createInitialRootReference(nodesManager));
    }

    @Test
    void shouldBeAbleToGetElementsFromPast()
    {
        final byte[] key = BinaryHelper.longToBytes(5L);
        final byte[] expectedValue1 = BinaryHelper.longToBytes(1L);
        final byte[] expectedValue2 = BinaryHelper.longToBytes(2L);
        final byte[] expectedValue3 = BinaryHelper.longToBytes(3L);

        bTree.put(key, expectedValue1);
        bTree.put(key, expectedValue2);
        bTree.put(key, expectedValue3);

        //index for history is 0 based
        assertArrayEquals(expectedValue1, bTree.get(key, 0));
        assertArrayEquals(expectedValue2, bTree.get(key, 1));
        assertArrayEquals(expectedValue3, bTree.get(key, 2));

        try
        {
            bTree.get(key, 3);
            fail();
        }
        catch (final VersionNotFoundException e)
        {
            assertEquals("The version 3 was not found.", e.getMessage());
        }

        //get latest version by default
        final byte[] actualLatest = bTree.get(key);
        assertArrayEquals(expectedValue3, actualLatest);
    }

    @Test
    void shouldRetrieveAllTheElements()
    {
        final int maxElements = 600;
        for (int i = 0; i < maxElements; i++)
        {
            final KeyValueUtils.Pair pair = generateKeyValuePair(i);
            bTree.put(pair.key, pair.value);
        }

        for (int i = 0; i < maxElements; i++)
        {
            final KeyValueUtils.Pair pair = generateKeyValuePair(i);
            assertArrayEquals(pair.value, bTree.get(pair.key));
        }
    }

    @Test
    void shouldConsumeKeyValuesInOrder()
    {
        final List<byte[]> expectedOrder = new ArrayList<>();
        for (long i = 0; i < 500; i++)
        {
            final byte[] bytes = BinaryHelper.longToBytes(i);
            expectedOrder.add(bytes);
            bTree.put(bytes, bytes);
        }

        expectedOrder.sort(ByteArrayComparator.INSTANCE);

        final LinkedList<byte[]> actualOrder = new LinkedList<>();
        bTree.consumeAll((key, value) -> actualOrder.addLast(key));

        assertEquals(expectedOrder.size(), actualOrder.size());

        for (int i = 0; i < expectedOrder.size(); i++)
        {
            assertArrayEquals(expectedOrder.get(i), actualOrder.get(i));
        }
    }

    @Test
    void shouldConsumeKeyValuesInOrderForAGivenVersion()
    {
        final List<byte[]> expectedOrder = new ArrayList<>();
        final int version = 400;
        for (long i = 0; i < 500; i++)
        {
            final byte[] bytes = BinaryHelper.longToBytes(i);
            if (i <= version)
            {
                expectedOrder.add(bytes);
            }

            bTree.put(bytes, bytes);
        }

        expectedOrder.sort(ByteArrayComparator.INSTANCE);

        final LinkedList<byte[]> actualOrder = new LinkedList<>();
        bTree.consumeAll(version, (key, value) -> actualOrder.addLast(key));

        assertEquals(expectedOrder.size(), actualOrder.size());

        for (int i = 0; i < expectedOrder.size(); i++)
        {
            assertArrayEquals(expectedOrder.get(i), actualOrder.get(i));
        }
    }

    @Test
    void shouldBeABleToRemoveKeysFromTree()
    {
        final int size = 600;
        for (int i = 0; i < size; i++)
        {
            final byte[] bytes = BinaryHelper.longToBytes(i);
            bTree.put(bytes, bytes);
        }

        for (int i = 0; i < size; i++)
        {
            final byte[] bytes = BinaryHelper.longToBytes(i);
            bTree.remove(bytes);
        }

        assertEquals(1L, bTree.getNodesCount());
    }

    @Test
    void shouldBeAbleToInsertElements()
    {
        for (int i = 0; i < 600; i++)
        {
            final byte[] bytes = BinaryHelper.longToBytes(i);
            bTree.put(bytes, bytes);
        }

        final String expectedTree = "digraph g {\n" +
                "node [shape = record,height=.1];\n" +
                "\"1935\"[label = \" <1934> |144|  <lastChild> |Ls \"];\n" +
                "\"1935\":1934 -> \"1934\"\n" +
                "\"1935\":lastChild -> \"1557\"\n" +
                "\"1934\"[label = \" <1633> |12|  <1659> |24|  <1736> |36|  <1762> |48|  <1839> |60|  <1865> |72|  <1933> |96|  <1144> |120|  <lastChild> |Ls \"];\n" +
                "\"1934\":1633 -> \"1633\"\n" +
                "\"1934\":1659 -> \"1659\"\n" +
                "\"1934\":1736 -> \"1736\"\n" +
                "\"1934\":1762 -> \"1762\"\n" +
                "\"1934\":1839 -> \"1839\"\n" +
                "\"1934\":1865 -> \"1865\"\n" +
                "\"1934\":1933 -> \"1933\"\n" +
                "\"1934\":1144 -> \"1144\"\n" +
                "\"1934\":lastChild -> \"1216\"\n" +
                "\"1633\"[label = \" <1563> |257|  <1572> |4|  <1580> |261|  <1589> |8|  <1597> |265|  <lastChild> |Ls \"];\n" +
                "\"1633\":1563 -> \"1563\"\n" +
                "\"1633\":1572 -> \"1572\"\n" +
                "\"1633\":1580 -> \"1580\"\n" +
                "\"1633\":1589 -> \"1589\"\n" +
                "\"1633\":1597 -> \"1597\"\n" +
                "\"1633\":lastChild -> \"1606\"\n" +
                "\"1563\"[label = \" <0> |0|  <256> |256|  <512> |512|  <1> |1| \"];\n" +
                "\"1572\"[label = \" <257> |257|  <513> |513|  <2> |2|  <258> |258|  <514> |514|  <3> |3|  <259> |259|  <515> |515| \"];\n" +
                "\"1580\"[label = \" <4> |4|  <260> |260|  <516> |516|  <5> |5| \"];\n" +
                "\"1589\"[label = \" <261> |261|  <517> |517|  <6> |6|  <262> |262|  <518> |518|  <7> |7|  <263> |263|  <519> |519| \"];\n" +
                "\"1597\"[label = \" <8> |8|  <264> |264|  <520> |520|  <9> |9| \"];\n" +
                "\"1606\"[label = \" <265> |265|  <521> |521|  <10> |10|  <266> |266|  <522> |522|  <11> |11|  <267> |267|  <523> |523| \"];\n" +
                "\"1659\"[label = \" <1614> |269|  <1623> |16|  <1631> |273|  <1641> |20|  <1649> |277|  <lastChild> |Ls \"];\n" +
                "\"1659\":1614 -> \"1614\"\n" +
                "\"1659\":1623 -> \"1623\"\n" +
                "\"1659\":1631 -> \"1631\"\n" +
                "\"1659\":1641 -> \"1641\"\n" +
                "\"1659\":1649 -> \"1649\"\n" +
                "\"1659\":lastChild -> \"1658\"\n" +
                "\"1614\"[label = \" <12> |12|  <268> |268|  <524> |524|  <13> |13| \"];\n" +
                "\"1623\"[label = \" <269> |269|  <525> |525|  <14> |14|  <270> |270|  <526> |526|  <15> |15|  <271> |271|  <527> |527| \"];\n" +
                "\"1631\"[label = \" <16> |16|  <272> |272|  <528> |528|  <17> |17| \"];\n" +
                "\"1641\"[label = \" <273> |273|  <529> |529|  <18> |18|  <274> |274|  <530> |530|  <19> |19|  <275> |275|  <531> |531| \"];\n" +
                "\"1649\"[label = \" <20> |20|  <276> |276|  <532> |532|  <21> |21| \"];\n" +
                "\"1658\"[label = \" <277> |277|  <533> |533|  <22> |22|  <278> |278|  <534> |534|  <23> |23|  <279> |279|  <535> |535| \"];\n" +
                "\"1736\"[label = \" <1666> |281|  <1675> |28|  <1683> |285|  <1692> |32|  <1700> |289|  <lastChild> |Ls \"];\n" +
                "\"1736\":1666 -> \"1666\"\n" +
                "\"1736\":1675 -> \"1675\"\n" +
                "\"1736\":1683 -> \"1683\"\n" +
                "\"1736\":1692 -> \"1692\"\n" +
                "\"1736\":1700 -> \"1700\"\n" +
                "\"1736\":lastChild -> \"1709\"\n" +
                "\"1666\"[label = \" <24> |24|  <280> |280|  <536> |536|  <25> |25| \"];\n" +
                "\"1675\"[label = \" <281> |281|  <537> |537|  <26> |26|  <282> |282|  <538> |538|  <27> |27|  <283> |283|  <539> |539| \"];\n" +
                "\"1683\"[label = \" <28> |28|  <284> |284|  <540> |540|  <29> |29| \"];\n" +
                "\"1692\"[label = \" <285> |285|  <541> |541|  <30> |30|  <286> |286|  <542> |542|  <31> |31|  <287> |287|  <543> |543| \"];\n" +
                "\"1700\"[label = \" <32> |32|  <288> |288|  <544> |544|  <33> |33| \"];\n" +
                "\"1709\"[label = \" <289> |289|  <545> |545|  <34> |34|  <290> |290|  <546> |546|  <35> |35|  <291> |291|  <547> |547| \"];\n" +
                "\"1762\"[label = \" <1717> |293|  <1726> |40|  <1734> |297|  <1744> |44|  <1752> |301|  <lastChild> |Ls \"];\n" +
                "\"1762\":1717 -> \"1717\"\n" +
                "\"1762\":1726 -> \"1726\"\n" +
                "\"1762\":1734 -> \"1734\"\n" +
                "\"1762\":1744 -> \"1744\"\n" +
                "\"1762\":1752 -> \"1752\"\n" +
                "\"1762\":lastChild -> \"1761\"\n" +
                "\"1717\"[label = \" <36> |36|  <292> |292|  <548> |548|  <37> |37| \"];\n" +
                "\"1726\"[label = \" <293> |293|  <549> |549|  <38> |38|  <294> |294|  <550> |550|  <39> |39|  <295> |295|  <551> |551| \"];\n" +
                "\"1734\"[label = \" <40> |40|  <296> |296|  <552> |552|  <41> |41| \"];\n" +
                "\"1744\"[label = \" <297> |297|  <553> |553|  <42> |42|  <298> |298|  <554> |554|  <43> |43|  <299> |299|  <555> |555| \"];\n" +
                "\"1752\"[label = \" <44> |44|  <300> |300|  <556> |556|  <45> |45| \"];\n" +
                "\"1761\"[label = \" <301> |301|  <557> |557|  <46> |46|  <302> |302|  <558> |558|  <47> |47|  <303> |303|  <559> |559| \"];\n" +
                "\"1839\"[label = \" <1769> |305|  <1778> |52|  <1786> |309|  <1795> |56|  <1803> |313|  <lastChild> |Ls \"];\n" +
                "\"1839\":1769 -> \"1769\"\n" +
                "\"1839\":1778 -> \"1778\"\n" +
                "\"1839\":1786 -> \"1786\"\n" +
                "\"1839\":1795 -> \"1795\"\n" +
                "\"1839\":1803 -> \"1803\"\n" +
                "\"1839\":lastChild -> \"1812\"\n" +
                "\"1769\"[label = \" <48> |48|  <304> |304|  <560> |560|  <49> |49| \"];\n" +
                "\"1778\"[label = \" <305> |305|  <561> |561|  <50> |50|  <306> |306|  <562> |562|  <51> |51|  <307> |307|  <563> |563| \"];\n" +
                "\"1786\"[label = \" <52> |52|  <308> |308|  <564> |564|  <53> |53| \"];\n" +
                "\"1795\"[label = \" <309> |309|  <565> |565|  <54> |54|  <310> |310|  <566> |566|  <55> |55|  <311> |311|  <567> |567| \"];\n" +
                "\"1803\"[label = \" <56> |56|  <312> |312|  <568> |568|  <57> |57| \"];\n" +
                "\"1812\"[label = \" <313> |313|  <569> |569|  <58> |58|  <314> |314|  <570> |570|  <59> |59|  <315> |315|  <571> |571| \"];\n" +
                "\"1865\"[label = \" <1820> |317|  <1829> |64|  <1837> |321|  <1847> |68|  <1855> |325|  <lastChild> |Ls \"];\n" +
                "\"1865\":1820 -> \"1820\"\n" +
                "\"1865\":1829 -> \"1829\"\n" +
                "\"1865\":1837 -> \"1837\"\n" +
                "\"1865\":1847 -> \"1847\"\n" +
                "\"1865\":1855 -> \"1855\"\n" +
                "\"1865\":lastChild -> \"1864\"\n" +
                "\"1820\"[label = \" <60> |60|  <316> |316|  <572> |572|  <61> |61| \"];\n" +
                "\"1829\"[label = \" <317> |317|  <573> |573|  <62> |62|  <318> |318|  <574> |574|  <63> |63|  <319> |319|  <575> |575| \"];\n" +
                "\"1837\"[label = \" <64> |64|  <320> |320|  <576> |576|  <65> |65| \"];\n" +
                "\"1847\"[label = \" <321> |321|  <577> |577|  <66> |66|  <322> |322|  <578> |578|  <67> |67|  <323> |323|  <579> |579| \"];\n" +
                "\"1855\"[label = \" <68> |68|  <324> |324|  <580> |580|  <69> |69| \"];\n" +
                "\"1864\"[label = \" <325> |325|  <581> |581|  <70> |70|  <326> |326|  <582> |582|  <71> |71|  <327> |327|  <583> |583| \"];\n" +
                "\"1933\"[label = \" <1872> |329|  <1881> |76|  <1889> |333|  <1898> |80|  <1906> |337|  <1915> |84|  <1923> |341|  <1932> |88|  <1059> |92|  <lastChild> |Ls \"];\n" +
                "\"1933\":1872 -> \"1872\"\n" +
                "\"1933\":1881 -> \"1881\"\n" +
                "\"1933\":1889 -> \"1889\"\n" +
                "\"1933\":1898 -> \"1898\"\n" +
                "\"1933\":1906 -> \"1906\"\n" +
                "\"1933\":1915 -> \"1915\"\n" +
                "\"1933\":1923 -> \"1923\"\n" +
                "\"1933\":1932 -> \"1932\"\n" +
                "\"1933\":1059 -> \"1059\"\n" +
                "\"1933\":lastChild -> \"1071\"\n" +
                "\"1872\"[label = \" <72> |72|  <328> |328|  <584> |584|  <73> |73| \"];\n" +
                "\"1881\"[label = \" <329> |329|  <585> |585|  <74> |74|  <330> |330|  <586> |586|  <75> |75|  <331> |331|  <587> |587| \"];\n" +
                "\"1889\"[label = \" <76> |76|  <332> |332|  <588> |588|  <77> |77| \"];\n" +
                "\"1898\"[label = \" <333> |333|  <589> |589|  <78> |78|  <334> |334|  <590> |590|  <79> |79|  <335> |335|  <591> |591| \"];\n" +
                "\"1906\"[label = \" <80> |80|  <336> |336|  <592> |592|  <81> |81| \"];\n" +
                "\"1915\"[label = \" <337> |337|  <593> |593|  <82> |82|  <338> |338|  <594> |594|  <83> |83|  <339> |339|  <595> |595| \"];\n" +
                "\"1923\"[label = \" <84> |84|  <340> |340|  <596> |596|  <85> |85| \"];\n" +
                "\"1932\"[label = \" <341> |341|  <597> |597|  <86> |86|  <342> |342|  <598> |598|  <87> |87|  <343> |343|  <599> |599| \"];\n" +
                "\"1059\"[label = \" <88> |88|  <344> |344|  <89> |89|  <345> |345|  <90> |90|  <346> |346|  <91> |91|  <347> |347| \"];\n" +
                "\"1071\"[label = \" <92> |92|  <348> |348|  <93> |93|  <349> |349|  <94> |94|  <350> |350|  <95> |95|  <351> |351| \"];\n" +
                "\"1144\"[label = \" <1083> |100|  <1095> |104|  <1107> |108|  <1119> |112|  <1131> |116|  <lastChild> |Ls \"];\n" +
                "\"1144\":1083 -> \"1083\"\n" +
                "\"1144\":1095 -> \"1095\"\n" +
                "\"1144\":1107 -> \"1107\"\n" +
                "\"1144\":1119 -> \"1119\"\n" +
                "\"1144\":1131 -> \"1131\"\n" +
                "\"1144\":lastChild -> \"1143\"\n" +
                "\"1083\"[label = \" <96> |96|  <352> |352|  <97> |97|  <353> |353|  <98> |98|  <354> |354|  <99> |99|  <355> |355| \"];\n" +
                "\"1095\"[label = \" <100> |100|  <356> |356|  <101> |101|  <357> |357|  <102> |102|  <358> |358|  <103> |103|  <359> |359| \"];\n" +
                "\"1107\"[label = \" <104> |104|  <360> |360|  <105> |105|  <361> |361|  <106> |106|  <362> |362|  <107> |107|  <363> |363| \"];\n" +
                "\"1119\"[label = \" <108> |108|  <364> |364|  <109> |109|  <365> |365|  <110> |110|  <366> |366|  <111> |111|  <367> |367| \"];\n" +
                "\"1131\"[label = \" <112> |112|  <368> |368|  <113> |113|  <369> |369|  <114> |114|  <370> |370|  <115> |115|  <371> |371| \"];\n" +
                "\"1143\"[label = \" <116> |116|  <372> |372|  <117> |117|  <373> |373|  <118> |118|  <374> |374|  <119> |119|  <375> |375| \"];\n" +
                "\"1216\"[label = \" <1155> |124|  <1167> |128|  <1179> |132|  <1191> |136|  <1203> |140|  <lastChild> |Ls \"];\n" +
                "\"1216\":1155 -> \"1155\"\n" +
                "\"1216\":1167 -> \"1167\"\n" +
                "\"1216\":1179 -> \"1179\"\n" +
                "\"1216\":1191 -> \"1191\"\n" +
                "\"1216\":1203 -> \"1203\"\n" +
                "\"1216\":lastChild -> \"1215\"\n" +
                "\"1155\"[label = \" <120> |120|  <376> |376|  <121> |121|  <377> |377|  <122> |122|  <378> |378|  <123> |123|  <379> |379| \"];\n" +
                "\"1167\"[label = \" <124> |124|  <380> |380|  <125> |125|  <381> |381|  <126> |126|  <382> |382|  <127> |127|  <383> |383| \"];\n" +
                "\"1179\"[label = \" <128> |128|  <384> |384|  <129> |129|  <385> |385|  <130> |130|  <386> |386|  <131> |131|  <387> |387| \"];\n" +
                "\"1191\"[label = \" <132> |132|  <388> |388|  <133> |133|  <389> |389|  <134> |134|  <390> |390|  <135> |135|  <391> |391| \"];\n" +
                "\"1203\"[label = \" <136> |136|  <392> |392|  <137> |137|  <393> |393|  <138> |138|  <394> |394|  <139> |139|  <395> |395| \"];\n" +
                "\"1215\"[label = \" <140> |140|  <396> |396|  <141> |141|  <397> |397|  <142> |142|  <398> |398|  <143> |143|  <399> |399| \"];\n" +
                "\"1557\"[label = \" <1288> |168|  <1360> |192|  <1432> |216|  <1554> |240|  <lastChild> |Ls \"];\n" +
                "\"1557\":1288 -> \"1288\"\n" +
                "\"1557\":1360 -> \"1360\"\n" +
                "\"1557\":1432 -> \"1432\"\n" +
                "\"1557\":1554 -> \"1554\"\n" +
                "\"1557\":lastChild -> \"1555\"\n" +
                "\"1288\"[label = \" <1227> |148|  <1239> |152|  <1251> |156|  <1263> |160|  <1275> |164|  <lastChild> |Ls \"];\n" +
                "\"1288\":1227 -> \"1227\"\n" +
                "\"1288\":1239 -> \"1239\"\n" +
                "\"1288\":1251 -> \"1251\"\n" +
                "\"1288\":1263 -> \"1263\"\n" +
                "\"1288\":1275 -> \"1275\"\n" +
                "\"1288\":lastChild -> \"1287\"\n" +
                "\"1227\"[label = \" <144> |144|  <400> |400|  <145> |145|  <401> |401|  <146> |146|  <402> |402|  <147> |147|  <403> |403| \"];\n" +
                "\"1239\"[label = \" <148> |148|  <404> |404|  <149> |149|  <405> |405|  <150> |150|  <406> |406|  <151> |151|  <407> |407| \"];\n" +
                "\"1251\"[label = \" <152> |152|  <408> |408|  <153> |153|  <409> |409|  <154> |154|  <410> |410|  <155> |155|  <411> |411| \"];\n" +
                "\"1263\"[label = \" <156> |156|  <412> |412|  <157> |157|  <413> |413|  <158> |158|  <414> |414|  <159> |159|  <415> |415| \"];\n" +
                "\"1275\"[label = \" <160> |160|  <416> |416|  <161> |161|  <417> |417|  <162> |162|  <418> |418|  <163> |163|  <419> |419| \"];\n" +
                "\"1287\"[label = \" <164> |164|  <420> |420|  <165> |165|  <421> |421|  <166> |166|  <422> |422|  <167> |167|  <423> |423| \"];\n" +
                "\"1360\"[label = \" <1299> |172|  <1311> |176|  <1323> |180|  <1335> |184|  <1347> |188|  <lastChild> |Ls \"];\n" +
                "\"1360\":1299 -> \"1299\"\n" +
                "\"1360\":1311 -> \"1311\"\n" +
                "\"1360\":1323 -> \"1323\"\n" +
                "\"1360\":1335 -> \"1335\"\n" +
                "\"1360\":1347 -> \"1347\"\n" +
                "\"1360\":lastChild -> \"1359\"\n" +
                "\"1299\"[label = \" <168> |168|  <424> |424|  <169> |169|  <425> |425|  <170> |170|  <426> |426|  <171> |171|  <427> |427| \"];\n" +
                "\"1311\"[label = \" <172> |172|  <428> |428|  <173> |173|  <429> |429|  <174> |174|  <430> |430|  <175> |175|  <431> |431| \"];\n" +
                "\"1323\"[label = \" <176> |176|  <432> |432|  <177> |177|  <433> |433|  <178> |178|  <434> |434|  <179> |179|  <435> |435| \"];\n" +
                "\"1335\"[label = \" <180> |180|  <436> |436|  <181> |181|  <437> |437|  <182> |182|  <438> |438|  <183> |183|  <439> |439| \"];\n" +
                "\"1347\"[label = \" <184> |184|  <440> |440|  <185> |185|  <441> |441|  <186> |186|  <442> |442|  <187> |187|  <443> |443| \"];\n" +
                "\"1359\"[label = \" <188> |188|  <444> |444|  <189> |189|  <445> |445|  <190> |190|  <446> |446|  <191> |191|  <447> |447| \"];\n" +
                "\"1432\"[label = \" <1371> |196|  <1383> |200|  <1395> |204|  <1407> |208|  <1419> |212|  <lastChild> |Ls \"];\n" +
                "\"1432\":1371 -> \"1371\"\n" +
                "\"1432\":1383 -> \"1383\"\n" +
                "\"1432\":1395 -> \"1395\"\n" +
                "\"1432\":1407 -> \"1407\"\n" +
                "\"1432\":1419 -> \"1419\"\n" +
                "\"1432\":lastChild -> \"1431\"\n" +
                "\"1371\"[label = \" <192> |192|  <448> |448|  <193> |193|  <449> |449|  <194> |194|  <450> |450|  <195> |195|  <451> |451| \"];\n" +
                "\"1383\"[label = \" <196> |196|  <452> |452|  <197> |197|  <453> |453|  <198> |198|  <454> |454|  <199> |199|  <455> |455| \"];\n" +
                "\"1395\"[label = \" <200> |200|  <456> |456|  <201> |201|  <457> |457|  <202> |202|  <458> |458|  <203> |203|  <459> |459| \"];\n" +
                "\"1407\"[label = \" <204> |204|  <460> |460|  <205> |205|  <461> |461|  <206> |206|  <462> |462|  <207> |207|  <463> |463| \"];\n" +
                "\"1419\"[label = \" <208> |208|  <464> |464|  <209> |209|  <465> |465|  <210> |210|  <466> |466|  <211> |211|  <467> |467| \"];\n" +
                "\"1431\"[label = \" <212> |212|  <468> |468|  <213> |213|  <469> |469|  <214> |214|  <470> |470|  <215> |215|  <471> |471| \"];\n" +
                "\"1554\"[label = \" <1443> |220|  <1455> |224|  <1467> |228|  <1479> |232|  <1491> |236|  <lastChild> |Ls \"];\n" +
                "\"1554\":1443 -> \"1443\"\n" +
                "\"1554\":1455 -> \"1455\"\n" +
                "\"1554\":1467 -> \"1467\"\n" +
                "\"1554\":1479 -> \"1479\"\n" +
                "\"1554\":1491 -> \"1491\"\n" +
                "\"1554\":lastChild -> \"1503\"\n" +
                "\"1443\"[label = \" <216> |216|  <472> |472|  <217> |217|  <473> |473|  <218> |218|  <474> |474|  <219> |219|  <475> |475| \"];\n" +
                "\"1455\"[label = \" <220> |220|  <476> |476|  <221> |221|  <477> |477|  <222> |222|  <478> |478|  <223> |223|  <479> |479| \"];\n" +
                "\"1467\"[label = \" <224> |224|  <480> |480|  <225> |225|  <481> |481|  <226> |226|  <482> |482|  <227> |227|  <483> |483| \"];\n" +
                "\"1479\"[label = \" <228> |228|  <484> |484|  <229> |229|  <485> |485|  <230> |230|  <486> |486|  <231> |231|  <487> |487| \"];\n" +
                "\"1491\"[label = \" <232> |232|  <488> |488|  <233> |233|  <489> |489|  <234> |234|  <490> |490|  <235> |235|  <491> |491| \"];\n" +
                "\"1503\"[label = \" <236> |236|  <492> |492|  <237> |237|  <493> |493|  <238> |238|  <494> |494|  <239> |239|  <495> |495| \"];\n" +
                "\"1555\"[label = \" <1515> |244|  <1527> |248|  <1537> |251|  <1552> |253|  <lastChild> |Ls \"];\n" +
                "\"1555\":1515 -> \"1515\"\n" +
                "\"1555\":1527 -> \"1527\"\n" +
                "\"1555\":1537 -> \"1537\"\n" +
                "\"1555\":1552 -> \"1552\"\n" +
                "\"1555\":lastChild -> \"1553\"\n" +
                "\"1515\"[label = \" <240> |240|  <496> |496|  <241> |241|  <497> |497|  <242> |242|  <498> |498|  <243> |243|  <499> |499| \"];\n" +
                "\"1527\"[label = \" <244> |244|  <500> |500|  <245> |245|  <501> |501|  <246> |246|  <502> |502|  <247> |247|  <503> |503| \"];\n" +
                "\"1537\"[label = \" <248> |248|  <504> |504|  <249> |249|  <505> |505|  <250> |250|  <506> |506| \"];\n" +
                "\"1552\"[label = \" <251> |251|  <507> |507|  <252> |252|  <508> |508| \"];\n" +
                "\"1553\"[label = \" <253> |253|  <509> |509|  <254> |254|  <510> |510|  <255> |255|  <511> |511| \"];\n" +
                "}\n";

        assertEquals(expectedTree, bTree.print());
    }
}